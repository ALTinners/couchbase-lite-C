# couchbase-lite-C

This is a generic cross-platform version of Couchbase Lite.  
Or, it will be when it's done.  
**It's in the very early stages of development.**

The base API is in ANSI C, and there is a C++ API consisting of inline wrappers around that. There's also an embryonic Python binding.

## Goals

(Unofficial; we have no PRD or design docs yet)

* C API
  - C++ is a stretch goal but easily achieved
  - Can be bound to other languages like JavaScript or Python
* API similar to other Couchbase Lite platforms
* Same feature set as other Couchbase Lite platforms
* Support common Linux distros, esp. Ubuntu and Raspbian
  - Will probably support macOS too, just for ease of development
  - Windows?
* Minimal platform dependencies other than filesystem and TCP/IP
* Run on Raspberry-Pi-level hardware
  - 32-bit and 64-bit
  - x86 and ARM
  - Hundreds of MB RAM, hundreds of MHz CPU, hundreds of MB storage
* Maybe include some language bindings like Python or JavaScript

## Example

### C

```c
// Open a database:
CBLError error;
CBLDatabaseConfiguration config = {"/tmp"};
CBLDatabase* db = cbl_db_open("my_db", &config, &error);

// Create a document:
CBLDocument* doc = cbl_doc_new("foo");
FLMutableDict props = cbl_doc_mutableProperties(doc);
FLMutableDict_SetString(props, "greeting"_sl, "Howdy!"_sl);

// Save the document:
const CBLDocument *saved = cbl_db_saveDocument(db, 
                                               doc, 
                                               kCBLConcurrencyControlFailOnConflict, 
                                               &error);
cbl_doc_release(saved);
cbl_doc_release(doc);

// Read it back:
const CBLDocument *readDoc = cbl_db_getDocument(db, "foo");
FLDict readProps = cbl_doc_properties(readDoc);
FLSlice greeting = FLValue_AsString( FLDict_Get(readProps, "greeting"_sl) );
cbl_doc_release(readDoc);
```

### C++

```cpp
// Open a database:
cbl::Database db(kDatabaseName, {"/tmp"});

// Create a document:
cbl::MutableDocument doc("foo");
doc["greeting"] = "Howdy!";
db.saveDocument(doc);

// Read it back:
cbl::Document doc = db.getMutableDocument("foo");
fleece::Dict readProps = doc->properties();
fleece::slice greeting = readProps["greeting"].asString();
```

### Python

```python
# Open a database:
db = Database("db", DatabaseConfiguration("/tmp"));

# Create a document:
doc = MutableDocument("foo")
doc["greeting"] = "Howdy!"
db.saveDocument(doc)

# Read it back:
readDoc = db.getDocument("foo")
readProps = readDoc.properties
greeting = readProps["greeting"]
```

## Documentation

These APIs are very preliminary, unreviewed, and probably incomplete!

* [C API documentation](http://labs.couchbase.com/couchbase-lite-C/C/html/modules.html) (generated by Doxygen from the header files)

## Building It

### With CMake

1. Clone the repo
2. Check out submodules (recursively)
3. `mkdir build_cmake`
4. `cd build_cmake`
5. `cmake .. && make -j5`
6. `./test/CBL_C_Tests -r list`

The library is at `build_cmake/libCouchbaseLiteC.dylib`. (Or `.DLL` or `.so`)

### With Xcode on macOS

1. Clone the repo
2. Check out submodules (recursively)
3. Open the Xcode project
4. Select scheme `CBL_Tests`
5. Run

The library is `libcouchbase_lite.dylib` in your `Xcode Build Products/Debug` directory (the path depends on your Xcode settings.)

### Python Bindings

This only works on Mac so far. And it assumes that Xcode puts build output in a `build` subdirectory next to the project file. (Want to fix this? Edit `BuildPyCBL.py` and look at the "`# FIX`" lines.)

1. Build the native library. (If using Xcode, build the "CBL_C Dylib" target.)
2. `pip install cffi`
3. `cd python/CouchbaseLite`
4. `python BuildPyCBL.py`
5. `cd ..`
6. `python test.py` -- some tests. Should run without throwing exceptions.

## Using It

* In your build settings, add the paths `include` and `vendor/couchbase-lite-core/vendor/fleece/API` (relative to this repo) to your header search paths.
* In your linker settings, add the dynamic library.
* In source files, add `#include "cbl/CouchbaseLite.h"`.
